<html>
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="utf-8">
	<link rel="shortcut icon" href="/qa-automation-forms/favicon.ico" type="image/x-icon" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/qa-automation-forms/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="/qa-automation-forms/form.css" />
</head>
<body>
	<h1 id="heading1" class="main-heading">Online Email Test</h1>
	<div class="table-info">
		<div class="row">
			<div class="cell">Environment:</div>
			<div class="cell table-info-cell-value" id="environmentName" data-shortName="qa-develop-crm.bloomerang.co/">qadev</div>
		</div>
		<div class="row">
			<div class="cell">Database:</div>
			<div class="cell table-info-cell-value" id="databaseName">jared30ordway</div>
		</div>
		<div class="row">
			<div class="cell">Widget ID:</div>
			<div class="cell table-info-cell-value" id="widgetId">327680</div>
		</div>
		<div class="row">
			<div class="cell">Processor:</div>
			<div class="cell table-info-cell-value">1pay</div>
		</div>
		<div class="row">
			<div class="cell">Email Response:</div>
			<div class="cell table-info-cell-value">Custom</div>
		</div>
		<div class="row">
			<div class="cell">Self Hosted:</div>
			<div class="cell table-info-cell-value">Yes</div>
		</div>
	</div>
	<div class="roundedblock gradtobottomright left">
		<div class="block-header">
			<div class="row">
				<span class="cell fa-stack fa-2x">
					<i class="far fa-circle fa-solid fa-stack-2x"></i>
					<i class="fas fa-gift fa-inverse fa-stack-1x"></i>
				</span>
				<h2 class="cell">Sign Up!</h2>
			</div>
		</div>
<script type="text/javascript" id="bloomerangForm334848"></script>
<pre><script type="text/javascript">
    var insertForm334848 = function() {
        var html334848 = '<style text=\'text/css\'>' + 
'.email-registration-form label{color: #404040;' + 
'                display: block;}' + 
'' + 
'.email-registration-form label.error{color:#900;' + 
'                display: inline-block; ' + 
'                padding: 0 10px;}' + 
'' + 
'.email-registration-form .field{padding: 4px 0;}' + 
'' + 
'.email-registration-form .consent{padding-bottom: 4px;}' + 
'' + 
'.email-registration-form .field .required-star{color: #aa0000; ' + 
'                display: inline-block; ' + 
'                margin-left: 5px;}' + 
'' + 
'.email-registration-form .field .checkboxes{max-width:275px;' + 
'                border: 1px solid #A9A9A9;' + 
'                -webkit-transition: all .3s ease-out;' + 
'                -moz-transition: all .3s ease-out;' + 
'                transition: all .3s ease-out;}' + 
'' + 
'.email-registration-form .field .checkbox{display:block;' + 
'                position:relative;' + 
'                -moz-box-sizing:border-box;' + 
'                box-sizing:border-box;' + 
'                height:30px;' + 
'                line-height:26px;' + 
'                padding:2px 28px 2px 8px;' + 
'                border-bottom:1px solid rgba(0,0,0,0.1);' + 
'                color:#404040;  ' + 
'                overflow:hidden;' + 
'                text-decoration:none; }' + 
'' + 
'.email-registration-form .field .checkbox input{opacity:0.01;' + 
'                position:absolute;' + 
'                left:-50px;  ' + 
'                z-index:-5;}' + 
'' + 
'.email-registration-form .field .checkbox:last-child{border-bottom:none;}' + 
'' + 
'.email-registration-form .field .checkbox.selected{background: rgb(50, 142, 253);' + 
'                color:#fff; }' + 
'' + 
'.email-registration-form .field .checkbox.selected:before{color:#fff;' + 
'                line-height:30px;' + 
'                position:absolute;' + 
'                right:10px; }' + 
'' + 
'.email-registration-form .field input{padding: 4px; ' + 
'                width: 275px;}' + 
'' + 
'.email-registration-form .errors{border: 1px solid #900;' + 
'                color: #900;  ' + 
'                padding: 10px;}' + 
'' + 
'.email-registration-form .hidden{display: none;}' + 
'' + 
'.btn-group .btn-submit-email{padding: 4px 10px;}' + 
'' + 
'input, select, textarea, button{font-family: inherit;}' + 
'' + 
'</style>' + 
'' + 
'<div id="email-registration-form-container">' + 
'  <form id="email-registration-form" class="email-registration-form" method="post" action="javascript:void(0)">' + 
'    <div class="errors hidden"></div>' + 
'    <div class="section contact">' + 
'      <h3>Contact Information</h3>' + 
'      <div class="field text first-name required" >' + 
'<label for="first-name"><span class="label">First Name</span><span class="required-star">*</span></label>' + 
'<input id="first-name" name="first-name" class="required" type="text"></input>' + 
'</div>' + 
'<div class="field text last-name required" >' + 
'<label for="last-name"><span class="label">Last Name</span><span class="required-star">*</span></label>' + 
'<input id="last-name" name="last-name" class="required" type="text"></input>' + 
'</div>' + 
'<div class="field email email-address required" >' + 
'<label for="email-address"><span class="label">Email</span><span class="required-star">*</span></label>' + 
'<input id="email-address" name="email-address" class="email required" type="email" placeholder="someone@website.com"></input>' + 
'</div>' + 
'<div class="consent">I want to receive emails at this address</div>' + 
'' + 
'</div>' + 
'    <div class="section custom-fields">' + 
'      <h3>Additional Information</h3>' + 
'      <div class="field text CustomAccountField_325633" >' + 
'<label for="CustomAccountField_325633"><span class="label">Location</span></label>' + 
'<input id="CustomAccountField_325633" name="CustomAccountField_325633" type="text" maxlength="255"></input>' + 
'</div>' + 
'' + 
'</div>' + 
'    <div class="section captcha">' + 
'      <label id=\'noCaptchaResponseError\' class=\'error noCaptchaResponseError\' style=\'display: none\'>You must fill out the CAPTCHA</label><div id="captcha334848"></div>' + 
'' + 
'</div>' + 
'    <div class="btn-group">' + 
'      <input class="btn btn-submit btn-submit-email" type="submit" value="Sign up"/>' + 
'    </div>' + 
'  </form>' + 
'</div>' + 
'' + 
'' +  '';var successHtml334848 = '<div class=\'donation-success\'>' +
                                                       '  <h2>Thank you for signing up</h2>' +
                                                       '  <p>Your email address has been added to our newsletter mailing list.</p>' + 
                                                        '   ' + 
                                                        '</div>';( function($) {if (!Bloomerang.useEmailId('334848')) { 
                                    html334848 = '<p style="color: red">Only one email sign-up form can be used on each page.</p>';
                                }
                                if (jQuery('#bloomerangForm334848').length) {
                        
                        jQuery('#bloomerangForm334848').after(html334848);
                        
                        
                        
                        
                        
                    };
                    if (Bloomerang.emailSignupFormLoaded) {
                                            return false;
                                        }
                                        Bloomerang.emailSignupFormLoaded = true;
                      
                        Bloomerang.reCaptchaV3SiteKey = '6Ldx9H4qAAAAAP7-cGZfZNXwusDi3w3kDgZm8VHj';
                        Bloomerang.gRecaptchaV3Threshold = 0.5;

                        window.captchaLoadCallback = function() {
                            Bloomerang.gRecaptchaLoaded = true;
                        };
                        
                        window.captchaV3LoadCallback = function() {
                            Bloomerang.gRecaptchaV3Loaded = true;
                        };

                        if(Bloomerang.donationFormReCaptchaV3SelfHostedFlag === undefined) {
                            function success (result) {
                                Bloomerang.donationFormReCaptchaV3SelfHostedFlag = result.DonationFormReCaptchaV3SelfHostedFlag;
                                initializeCaptcha();
                            }
                                
                            function failure (result) {
                                Bloomerang.donationFormReCaptchaV3SelfHostedFlag = false;
                                initializeCaptcha();
                            } 

                            Bloomerang.Api._post('v1/ReCaptchaV3SelfHostedFlag', {}, success, failure);
                        } else {
                            initializeCaptcha();
                        }

                        async function getRecaptchaV3Token() {
                              const token = await new Promise((resolve, reject) => {
                                 grecaptcha.ready(function() {
                                    grecaptcha.execute(Bloomerang.reCaptchaV3SiteKey, {action: 'submit'}).then(function(token) {
                                       resolve(token);
                                     });
                                  });
                                });

                                return token;
                        }
                        
                        function initializeCaptcha() {
                            Bloomerang.Util.load('https://www.google.com/recaptcha/api.js?onload=captchaLoadCallback&render=explicit',
                                function() { return Bloomerang.gRecaptchaLoaded; },
                                function() {
                                    jQuery('.section.captcha').removeAttr('style');
                                    jQuery('form.email-registration-form').data('captcha-id', grecaptcha.render('captcha334848', { 'sitekey' : '6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI' }));
                                    
                                    if((Bloomerang.donationFormReCaptchaV3Flag && Bloomerang.isBloomerangHostedForm && Bloomerang.isDonationForm) || (Bloomerang.donationFormReCaptchaV3SelfHostedFlag && !Bloomerang.isBloomerangHostedForm && Bloomerang.reCaptchaV3SiteKey && Bloomerang.isDonationForm)) {
                                        jQuery('.section.captcha').attr('style', 'display: none');
                                    }
                                },
                                true,
                                true);
                            
                            if((Bloomerang.donationFormReCaptchaV3Flag && Bloomerang.isBloomerangHostedForm && Bloomerang.isDonationForm) || (Bloomerang.donationFormReCaptchaV3SelfHostedFlag && !Bloomerang.isBloomerangHostedForm && Bloomerang.isDonationForm && Bloomerang.reCaptchaV3SiteKey)) {
                                 Bloomerang.Util.load(`https://www.google.com/recaptcha/api.js?onload=captchaV3LoadCallback&render=${Bloomerang.reCaptchaV3SiteKey}`,
                                    function() { return Bloomerang.gRecaptchaV3Loaded; },
                                    function() {
                                        grecaptcha.ready(function() {
                                          grecaptcha.execute(Bloomerang.reCaptchaV3SiteKey, {action: 'submit'}).then(function(token) {
                                              async function success (result) {
                                                if(parseFloat(result.Score) < Bloomerang.gRecaptchaV3Threshold) {
                                                    Bloomerang.isForcePuzzle = true;
                                                    jQuery('.section.captcha').attr('style', 'display: block');
                                                } else {

                                                    const initialRecaptchaV3Token = await getRecaptchaV3Token();

                                                     // Append to the form data container to be included when submitting the form on bloomerangV2.js
                                                     Bloomerang.captchaResponseV3(initialRecaptchaV3Token);

                                                     setInterval(async ()=> {
                                                         const recaptchaV3Token = await getRecaptchaV3Token();

                                                        // Append to the form data container to be included when submitting the form on bloomerangV2.js
                                                        Bloomerang.captchaResponseV3(recaptchaV3Token);
                                                     }, 80000);
                                                }
                                               }
                                                
                                               function failure (result) {
                                                Bloomerang.isForcePuzzle = true;
                                                jQuery('.section.captcha').attr('style', 'display: block');
                                               }
                                                
                                               var data = {
                                                  token: token,
                                                  isSelfHosted: !Bloomerang.isBloomerangHostedForm
                                               };
                                                
                                                Bloomerang.Api._post('v1/ReCaptchaV3', data, success, failure);
                                          });
                                        });
                                    },
                                    true,
                                    true);
                               }
                           }
                            
                    
                    Bloomerang.useKey('pub_1aaf14ca-dc57-11f0-8fb9-02fae4787ea3');

        // Register proper callbacks for various stages/outcomes of submission
        Bloomerang.Widget.Email.OnSubmit = function (args) {
            jQuery(".btn-submit-email").val("Registering...").prop("disabled", true).addClass("disabled");
            var val = function (selector) { return jQuery(selector).val(); };
            Bloomerang.Account
                    .individual()
                    .firstName(val(".email-registration-form #first-name"))
                    .lastName(val(".email-registration-form #last-name"))
                    .homeEmail(val(".email-registration-form #email-address"))
                    .applyEmailSignupCustomFields();
                    
           Bloomerang.Interaction.applyEmailSignupCustomFields();
        };
        Bloomerang.ValidateEmailSignupFormCaptcha = function() {
            if (typeof(grecaptcha) !== "undefined" && jQuery("#captcha" + Bloomerang.Data.WidgetIds.EmailSignup).children().length) {
                var captchaResponse = grecaptcha.getResponse(jQuery(".email-registration-form").data("captcha-id"));
                if (captchaResponse) {
                    jQuery(".email-registration-form .noCaptchaResponseError").hide();
                    Bloomerang.captchaResponse(captchaResponse);
                    return true;
                } else {
                    jQuery(".email-registration-form .noCaptchaResponseError").show();
                    return false;
                }
            } else return true;
        };
        Bloomerang.Api.OnSuccess = Bloomerang.Widget.Email.OnSuccess = function (response) {
            jQuery("#email-registration-form-container").html(successHtml334848);
            var distance = 100;
            var offset = jQuery("#email-registration-form-container").offset().top;
            var offsetTop = offset > distance ? offset - distance : offset;
		        jQuery('html, body').animate({ scrollTop : offsetTop}, 500);
        };
        Bloomerang.Api.OnError = Bloomerang.Widget.Email.OnError = function (response) {
            jQuery(".btn-submit-email").val("Register").prop("disabled", false).removeClass("disabled");
            jQuery("#email-registration-form-container .errors").removeClass("hidden").html(response.Message);
            var distance = 100;
            var offset = jQuery("#email-registration-form-container .errors").offset().top;
            var offsetTop = offset > distance ? offset - distance : offset;
		        jQuery('html, body').animate({ scrollTop : offsetTop}, 500);
            if (typeof(grecaptcha) !== "undefined" && jQuery("#captcha" + Bloomerang.Data.WidgetIds.EmailSignup).children().length) {
              grecaptcha.reset(jQuery(".email-registration-form").data("captcha-id"));
            }
        };
        
        Bloomerang.Util.applyEmailSignupCustomFields = function (obj, type) {
        
            // Clear any fields from a previous failed submission
            obj.clearCustomFields();
        
            // Apply all <input> (not multiselect), <select> and <textarea> fields
            jQuery(".email-registration-form .section.custom-fields :input:not(a > input, select)[id*=" + type + "]").each(function() {
                if (jQuery(this).val().hasValue()) {
                    obj.customFreeformField(jQuery(this).attr("id").toUntypedValue(), jQuery(this).val());
                }
            });
            
            // Apply all <select> fields
            jQuery(".email-registration-form .section.custom-fields select[id*=" + type + "]").each(function() {
                if (jQuery(this).val().hasValue()) {
                    obj.customPickField(jQuery(this).attr("id").toUntypedValue(), jQuery(this).val());
                }
            });
                
            // Apply all multiselect fields
            jQuery(".email-registration-form .section.custom-fields .checkboxes[id*=" + type + "]").each(function() {
                obj.customPickField(jQuery(this).attr("id").toUntypedValue(),
                jQuery.map(jQuery(this).children(".checkbox.selected"), function(v) { return jQuery(v).attr("data-id"); }));
            });
        };
        
        String.prototype.hasValue = function() {
            return (this && jQuery.trim(this)); //IE8 doesn't have a native trim function
        };
        
        Bloomerang.Account.applyEmailSignupCustomFields = function () {
            Bloomerang.Util.applyEmailSignupCustomFields(this, "Account");
            return this;
        };
        
        Bloomerang.Interaction.applyEmailSignupCustomFields = function () {
            Bloomerang.Util.applyEmailSignupCustomFields(this, "Interaction");
            return this;
        };
        
        String.prototype.toUntypedValue = function() {
            return this.substring(this.indexOf('_') + 1);
        };

        jQuery.validator.addMethod("currency", function (value, element, options) {
            return !value ||
                value
                  .replace("$", "")
                  .replace(".", "")
                  .split(",").join("")
                  .match(/^\d+$/g);
        }, "Not a valid currency");

        jQuery.validator.classRuleSettings.currency = { currency: true };

        jQuery.validator.addMethod("number", function (value, element, options) {
            return !value ||
                value
                  .replace(".", "")
                  .split(",").join("")
                  .match(/^\d+$/g);
        }, "Not a valid number");

        jQuery.validator.classRuleSettings.number = { number: true };
        
        jQuery.validator.addMethod("validYear", function (value, element, options) {
            try {
                return (!value || value.match(/^[1-9]\d\d\d$/)) ? true : false;
            }
            catch (e) {
                return false;
            }
        }, function () { return "Must be a 4 digit year"; });

        jQuery.validator.classRuleSettings.validYear = { validYear: true };

        // Intercept form submission to validate then submit via API
        jQuery("#email-registration-form-container form").validate({
            submitHandler: function () {
                if (!Bloomerang.ValidateEmailSignupFormCaptcha()) {
                  return false;
                }
            
                // Restore proper callbacks in case there are multiple widgets on the page
                Bloomerang.Api.OnSubmit = Bloomerang.Widget.Email.OnSubmit;
                Bloomerang.Api.OnSuccess = Bloomerang.Widget.Email.OnSuccess;
                Bloomerang.Api.OnError = Bloomerang.Widget.Email.OnError;
                Bloomerang.Api.joinMailingList();
            }
        });
        
})(jQuery);
    };
    
                var startBloomerangLoad = function() {
                    if (window.bloomerangLoadStarted == undefined) {
                        window.bloomerangLoadStarted = true;
                        var script = document.createElement('script');
                        script.type = 'text/javascript';
                        script.src = 'https://qa-develop-crm.bloomerang.co/Content/Scripts/Api/Bloomerang-v2.js?nocache=1768498608';
                        document.getElementsByTagName('head')[0].appendChild(script);
                        waitForBloomerangLoad(function() { Bloomerang.Util.requireJQueryValidation(function() { insertForm334848(); })});
                    }
                    else {
                        waitForBloomerangLoad(function() { Bloomerang.Util.requireJQueryValidation(function() { insertForm334848(); })});
                    }
                };

                var waitForBloomerangLoad = function(callback) {
                    if (typeof(Bloomerang) === 'undefined' || !Bloomerang._isReady) {
                        setTimeout(function () { waitForBloomerangLoad(callback) }, 500);
                    }
                    else {
                        if (true) {
                            callback();
                        } else {
                            window.bloomerangLoadStarted = undefined;
                            Bloomerang = undefined; // The version of Blomerang.js is not what we want. So blow it away and reload.
                            startBloomerangLoad();
                        }
                    }
                };

                startBloomerangLoad();
</script></pre>
	</div>
</body>
</html>
